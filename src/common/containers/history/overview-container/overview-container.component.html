<div *ngIf="globalError$ | async as globalError" class="row">
    <div *ngIf="globalError?.length !== 0" class="col-12">
        <lnd-alert type="danger">
            <ng-container *ngFor="let error of globalError">
                {{ error }}<br />
            </ng-container>
        </lnd-alert>
    </div>
</div>

<lnd-placeloader
    *ngIf="isLoading$ | async; else dataTemplate"
    [loading]="true"
></lnd-placeloader>

<ng-template #dataTemplate>
    <ng-container
        *ngIf="history$ | async | keyvalue: orderKeyValueByKeyDest as history"
    >
        <lnd-info-banner
            *ngIf="history.length === 0"
            [bannerTitle]="'Zatím nemáte žádnou historickou smlouvu'"
            [showButton]="false"
        >
            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <p>
                        V případě zájmu o dodávku energií pro nové odběrné
                        místo, pokračujte prosím zadáním odběrného místa
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col-12 text-center">
                    <lnd-button
                        (action)="createSupplyPoint($event)"
                        label="Nové odběrné místo"
                        type="primary"
                    >
                    </lnd-button>
                </div>
            </div>
        </lnd-info-banner>
        <ng-container *ngIf="history.length !== 0">
            <div class="row mb-5">
                <div class="col text-center">
                    <p class="mb-2">
                        Pokud máte zájem o dodávku energií pro další odběrné
                        místo, doporučujeme zkontrolovat, zda k němu nemáte
                        rozpracovanou smlouvu.
                    </p>
                    <p>
                        Pokud ne, pokračujte založením nového odběrného místa.
                    </p>
                    <lnd-button
                        label="ZALOŽIT NOVÉ ODBĚRNÉ MÍSTO"
                        type="secondary"
                        (action)="createSupplyPoint($event)"
                    ></lnd-button>
                </div>
            </div>
            <div *ngFor="let historyOfSupplyPoints of history" class="row">
                <div class="col-12 col-xl-10 offset-xl-1 mb-5">
                    <h2 class="text-center">
                        Odběrná místa s ukončenou dodávkou energií za rok {{
                        historyOfSupplyPoints.key }}
                    </h2>
                    <div
                        *ngFor="let supplyPoint of historyOfSupplyPoints.value"
                        class="supply-points"
                    >
                        <pxe-supply-point
                            [data]="supplyPoint"
                            (action)="navigateToHistoryDetail($event)"
                        >
                        </pxe-supply-point>
                    </div>
                </div>
            </div>
        </ng-container>
    </ng-container>
</ng-template>
