<div class="container-fluid">
    <div class="container-content">
        <pxe-layout-container pageTitle="Podepsání smlouvy">
            <div class="row mb-6">
                <div class="col-12 col-xl-10 offset-xl-1">
                    <pxe-progress-bar [config]="configStepper"></pxe-progress-bar>
                </div>
            </div>
            <div class="row">
                <div class="col-12 col-md-12">
                    <lnd-alert
                        *ngIf="globalError.length"
                        type="danger">
                        <ng-container *ngFor="let error of globalError">
                            {{ error }}<br>
                        </ng-container>
                    </lnd-alert>
                </div>
            </div>
            <div *ngIf="supplyPoint"
                 class="row">
                <lnd-button
                        label="download"
                        (action)="openDocument('717', documentType.CONTRACT)"
                        [isDisabled]="documentLoading"
                        type="link"
                ></lnd-button>
                <div class="col-10 offset-1">
                    <div class="row align-items-center mb-3">
                        <div class="col-12 mb-5 col-md-3 mb-md-0 text-center text-md-left">
                            <lnd-button
                                label="Krok zpět"
                                type="secondary"
                                (action)="navigateRequestService.backStepAction(supplyPoint, PREVIOUS_PROGRESS_STATUS )">
                            </lnd-button>
                        </div>
                        <div class="col-12 col-md-6 text-center">
                            <h2 class="mb-0">
                                Podepište smlouvu
                            </h2>
                        </div>
                    </div>
                </div>
                <div *ngIf="!supplyPoint.contract.offerValidity"
                     class="col-12 col-xl-10 offset-xl-1">
                    <lnd-banner-ui
                        [data]="{
                            text: 'Platnost nabídky vypršela.'
                        }"
                        buttonLabel="Vybrat novou nabídku"
                        (customBannerAction)="chooseNewOfferAction($event)">
                    </lnd-banner-ui>
                    <p class="mt-5">
                        Tato nabídka již není aktivní. Dokumenty k uzavření dodávky energií/plynu dále nejsou k dispozici.
                        Pokud máte pořád zájem o dodávku energií/plynu pro vaše odběrné místo, vyberte prosím novou nabídku.
                    </p>
                </div>
                <div class="col-12 text-center mb-2 d-xl-none">
                    <lnd-button
                        [label]="showOffer ? 'Skrýt nabídku' : 'Zobrazit nabídku'"
                        type="link"
                        (click)="toggleOffer()">
                    </lnd-button>
                </div>
                <div
                    class="col-12 col-xl-10 offset-xl-1 d-xl-block"
                    [class.d-block]="showOffer"
                    [class.d-none]="!showOffer">
                    <pxe-supply-point-offer
                        [supplyPointOffer]="supplyPoint.contract.offer"
                        [interactive]="true">
                    </pxe-supply-point-offer>
                </div>
                <div *ngIf="supplyPoint.contract.offerValidity"
                     class="col-12 col-xl-10 offset-xl-1">
                    <div class="page-box">
                        <div [innerHTML]="contractTemplate"></div>
                        <pxe-verification-form
                            *ngIf="supplyPoint | pathValue:['contract', 'personalData', 'phone']"
                            [fieldError]="fieldError"
                            [formLoading]="formLoading"
                            [contract]="supplyPoint.contract"
                            [globalError]="globalError"
                            [showSentSmsLabelUnderFirstField]="false"
                            [smsSent]="smsSent"
                            (submitAction)="signContract($event)"
                            (customAction)="sendContractConfirmationSms()"
                        ></pxe-verification-form>
                    </div>
                </div>
            </div>
        </pxe-layout-container>
    </div>
</div>
